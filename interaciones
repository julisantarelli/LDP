with 
	conv as (
			select 
				uc.*, 
				u."role", 
				lead(uc."userId",1) over(partition by uc."conversationId") as "userId2",
				lead(u."role",1) over(partition by uc."conversationId") as "role2",
				concat(uc."userId",'-',lead(uc."userId",1) over(partition by uc."conversationId")) as "concatIds",
				concat(u."role",lead(u."role",1) over(partition by uc."conversationId")) as "concatRoles" 
			from public.users_conversations uc 
			left join public.users u on uc."userId" = u.id
	),
	conv_filter as (
			select "concatIds","userId","userId2" as "targetUserId","role","role2" as "targetRole",1 as "conversation"
			from conv
			where "concatRoles" in ('PLAYERCLUB','CLUBPLAYER','PLAYERAGENTE','AGENTEPLAYER')
	),
	shares as (
			select 
				i.*, 
				concat(i."userId",'-',i."targetUserId") as "concatIds",
				u."role" as "role", 
				u2."role" as "targetRole",
				concat(u."role",u2."role") as "concatRoles" 
			from public.users_shares i 
			left join public.users u on i."userId" = u.id
			left join public.users u2 on "targetUserId" = u2.id
	),
	shares_filter as (
			select "concatIds","userId","targetUserId","role","targetRole",1 as "share"
			from shares
			where "concatRoles" in ('CLUBPLAYER','AGENTPLAYER')
	),
	followers as (
			select 
				i.*,
				concat(i."userId",'-',i."targetUserId") as "concatIds", 
				u."role" as "role", 
				u2."role" as "targetRole",
				concat(u."role",u2."role") as "concatRoles" 
			from public.users_followers i 
			left join public.users u on i."userId" = u.id
			left join public.users u2 on "targetUserId" = u2.id
	),
	followers_filter as (
			select "concatIds","userId","targetUserId","role","targetRole",1 as "follow"
			from followers
			where "concatRoles" in ('CLUBPLAYER','AGENTPLAYER')
	),
	favourites as (
			select 
				i.*, 
				concat(i."userId",'-',i."targetUserId") as "concatIds",
				u."role" as "role", 
				u2."role" as "targetRole",
				concat(u."role",u2."role") as "concatRoles" 
			from public.users_favorites i 
			left join public.users u on i."userId" = u.id
			left join public.users u2 on "targetUserId" = u2.id
	),
	favourites_filter as(
			select "concatIds","userId","targetUserId","role","targetRole",1 as  "favourites"
			from favourites
			where "concatRoles" in ('CLUBPLAYER','AGENTPLAYER')
	),
	likes as (
			select 
				i.*, 
				concat(i."userId",'-',i."targetUserId") as "concatIds",
				u."role" as "role", 
				u2."role" as "targetRole",
				concat(u."role",u2."role") as "concatRoles" 
			from public.users_likes i 
			left join public.users u on i."userId" = u.id
			left join public.users u2 on "targetUserId" = u2.id
	),
	likes_filter as (
			select "concatIds","userId","targetUserId","role","targetRole",1 as   "likes"
			from likes
			where "concatRoles" in ('CLUBPLAYER','AGENTPLAYER') 
	),
	visits  as (
			select 
				i.*, 
				concat(i."userId",'-',i."targetUserId") as "concatIds",
				u."role" as "role", 
				u2."role" as "targetRole",
				concat(u."role",u2."role") as "concatRoles" 
			from public.users_visits i 
			left join public.users u on i."userId" = u.id
			left join public.users u2 on "targetUserId" = u2.id
	),
	visits_filter as (
			select "concatIds","userId","targetUserId","role","targetRole",1 as  "visits"
			from visits
			where "concatRoles" in ('CLUBPLAYER','AGENTPLAYER') 
	),
	union_tables as(
			select 
				"concatIds" ,"userId" , "targetUserId" ,"role" ,"targetRole" ,
				"conversation",
				 0 as "share",
				 0 as "follow",
				 0 as "favourites",
				 0 as "likes",
				 0 as "visits"
			from conv_filter 
		union all
			select 
				"concatIds" ,"userId" , "targetUserId" ,"role" ,"targetRole" ,
				0 as "conversation",
				"share",
				0 as "follow",
				0 as "favourites",
				0 as "likes",
				0 as "visits"
			from shares_filter 
		union all
			select 
				"concatIds" ,"userId" , "targetUserId" ,"role" ,"targetRole" ,
				0 as "conversation",
				0 as "share",
				"follow",
				0 as "favourites",
				0 as "likes",
				0 as "visits"
			from followers_filter 
		union all
			select 
				"concatIds" ,"userId" , "targetUserId" ,"role" ,"targetRole" ,
				0 as "conversation",
				0 as "share",
				0 as "follow",
				"favourites",
				0 as "likes",
				0 as "visits"
			from favourites_filter 
		union all
			select 
				"concatIds" ,"userId" , "targetUserId" ,"role" ,"targetRole" ,
				0 as "conversation",
				0 as "share",
				0 as "follow",
				0 as "favourites",
				"likes",
				0 as "visits"
			from likes_filter
		union all
			select 
				"concatIds" ,"userId" , "targetUserId" ,"role" ,"targetRole" ,
				0 as "conversation",
				0 as "share",
				0 as "follow",
				0 as "favourites",
				0 as "likes",
				"visits"
			from visits_filter)
			
select 
	"concatIds" ,"userId" , "targetUserId" ,"role" ,"targetRole" ,
	sum("conversation") as "conversation",
	sum("share") as "share",
	sum("follow") "as follow",
	sum("favourites") as "favourites",
	sum("likes") as "likes",
	sum("visits") as "visits" 
from union_tables
group by 1,2,3,4,5
    
    





	




	


